module <%= class_name %>
  class ApplicationController < ::ApplicationController
    prepend_view_path 'app/views/<%= model_path %>'

    before_filter :authorize_company!
    helper_method :current_company

    susanin(
      root: ->(r) { [:client, r] }
    )

    <% if %>
    inlcude MockAuthorization
    check_authorization
    rescue_from CanCan::AccessDenied do |exception|
      redirect_to destroy_user_session_url, :alert => exception.message
    end

    http_basic_authenticate_with name: Settings.admin.name, password: Settings.admin.password

    protected

    def title_prefix
      current_company.name
    end

    def current_company
      @current_company ||= current_user.company
    end

    def current_ability
      @current_ability ||= Ability.new(current_user, current_company)
    end

    def authorize_company!
      authorize! :login, current_company
    end

  end
end
